---
layout: post
title: 群晖NAS使用NFS共享文件，关联Synology
categories: [cm, linux]
tags: []
---

* 参考
  * [如何在本地网络 (NFS) 中访问 Synology NAS 上的文件](https://kb.synology.cn/zh-cn/DSM/tutorial/How_to_access_files_on_Synology_NAS_within_the_local_network_NFS)
  * [Linux通过NFS访问群晖NAS上的文件](https://www.unwit.cn/zsk/11.shtml)
  * [指定共享文件夹的 NFS 权限操作步骤](https://www.suncan.com.cn/archives/5840)
  * [群晖NFS 共享权限设置](https://www.jianshu.com/p/6cfca5f0dd21)
  * [群晖NAS创建nfs共享文件夹提供Linux k8s使用](https://frps.cn/57.html)
  * [Linux(Ubuntu)通过NFS服务挂载群晖NAS为虚拟磁盘](https://www.caidhome.cn/details/414)
  * [指派 NFS 权限](https://kb.synology.cn/zh-cn/DSM/help/DSM/AdminCenter/file_share_privilege_nfs?version=6)
  * []()
  * []()


## 群晖服务端配置

1. 启动NFS服务
    控制面板 - 文件服务 - SMB/AFP/NFS - 启动NFS服务
1. 设置共享文件的NFS共享
    控制面板 - 共享文件夹 - 选中目标文件夹 - 编辑 - NFS权限 Tab页
    服务器名称或IP地址： * （任意IP地址） 或者  192.168.1.1/24（子网地址）
    权限： 可读写
    Squash： 映射所有用户为admin
    安全性： sys
    勾选  启动异步
    勾选  允许来自非特权端口的连接（大于1024的端口）
    勾选  允许用户访问已装载的子文件夹


## Linux 客户端设置

* 参考
  * [Linux NFS Mount Entry in fstab ( /etc/fstab ) with Example](https://linoxide.com/example-linux-nfs-mount-entry-in-fstab-etcfstab/)
  * [How To Auto Mount a FileSystem Using Systemd](https://www.thegeekdiary.com/how-to-auto-mount-a-filesystem-using-systemd/)
  * [Mount vs automount systemd units: which one to use for what?](https://unix.stackexchange.com/questions/570958/mount-vs-automount-systemd-units-which-one-to-use-for-what)
  * [fstab与systemd.mount自动挂载的一点研究和见解](https://zhangguanzhang.github.io/2019/01/30/fstab/)
  * [Using the systemctl command to manage systemd units](https://opensource.com/article/20/5/systemd-units)
  * []()
  * []()
  * []()
  * []()


1. 安装
    ~~~sh
    # ubuntu / Debian
    sudo apt install nfs-common
    ~~~

1. `/etc/fstab` 配置
    ~~~sh
    host.myserver.com:/home /mnt/home nfs rw,hard,intr,rsize=8192,wsize=8192,timeo=14 0 0
    ~~~


### Arch Linux / Manjaro

* 参考
  * <https://wiki.archlinux.org/title/NFS#Client>
  * <https://wiki.archlinux.org/title/Fstab#Remote_file_system>
  * <https://wiki.archlinux.org/title/Systemd#Using_units>
  * <https://man.archlinux.org/man/systemd.automount.5>
  * []()
  * []()
  * []()


#### 手动挂载

这种方法，一般用在调试阶段，看看能不能正常连接，权限是否正常。

~~~sh
# 如果不是 NFSv4 就删掉 vers=4
mount -t nfs -o vers=4 servername:/srv/nfs/music /mountpoint/on/client

Created symlink /run/systemd/system/remote-fs.target.wants/rpc-statd.service → /usr/lib/systemd/system/rpc-statd.service.
~~~

#### /etc/fstab 自动挂载

这种方法，适合作为日常不定时访问的文件共享，但是，如果有系统服务依赖这个共享存储，就要使用 systemd 的 mount 和 automount 了。

* 配合systemd的配置（推荐）

    1. 修改 `/etc/fstab`
        ~~~sh
        servername:/home   /mountpoint/on/client  nfs  _netdev,noauto,x-systemd.automount,x-systemd.mount-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0
        ~~~
    1. 重新加载配置
        ~~~sh
        sudo systemctl daemon-reload
        sudo systemctl restart remote-fs.target
        ~~~


* 通用的配置，在没有systemd的时候，也可以用这种方法。

    1. 修改 `/etc/fstab`

        ~~~sh
        servername:/music   /mountpoint/on/client   nfs   defaults,timeo=900,retrans=5,_netdev	0 0
        ~~~


















