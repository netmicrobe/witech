---
layout: post
title: nmap扫描脚本
categories: [cm, linux]
tags: [security, bash, shell]
---

* 参考
  * []()
  * []()
  * []()


* nmap-csv-scan.sh

~~~bash
#!/bin/bash
TMPFILE=tmp.txt
RESULT_FILE="results-$(date +%Y%m%d_%H%M%S).csv"
echo "Executed on $(curl -4 icanhazip.com)" >> $RESULT_FILE
echo ""  >> $RESULT_FILE
while IFS="," read -r rec_column1 ip port rec_column4
do
  nmap -p $port -Pn $ip > $TMPFILE
  echo "$ip, $port, $(cat $TMPFILE | awk '/PORT\s+STATE\s+SERVICE/{getline;print;}' | awk -F' ' '{print $2}')" >> $RESULT_FILE
done < $1
~~~

* `$1` 传入类似如下格式的csv文件

test.csv

~~~
归属部门,192.168.1.101,135,msrpc,未上报端口
归属部门,192.168.1.173,135,msrpc,未上报端口
~~~

* 使用脚本

~~~bash
./nmap-csv-scan.sh test.csv
~~~

结果保存在当前目录 result-YYYYmmdd-HHMMSS.csv 中。
