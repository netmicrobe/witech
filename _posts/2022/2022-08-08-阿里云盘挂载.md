---
layout: post
title: 阿里云盘挂载，关联 webDAV
categories: [ cm ]
tags: []
---

* 参考
  * []()
  * []()
  * []()



## aliyundrive-webdav

<https://github.com/messense/aliyundrive-webdav>

阿里云盘 WebDAV 服务，主要使用场景为配合支持 WebDAV 协议的客户端 App 如 Infuse、nPlayer 等实现在电视上直接观看云盘视频内容， 支持上传文件，但受限于 WebDAV 协议不支持文件秒传。

如果你使用 Emby 或者 Jellyfin，也可以试试 aliyundrive-fuse 项目。

1. 安装 aliyundrive-webdav

* ARM 架构例子： 

~~~
wget https://github.com/messense/aliyundrive-webdav/releases/download/v1.8.9/aliyundrive-webdav_1.8.9-1_aarch64_generic.ipk
wget https://github.com/messense/aliyundrive-webdav/releases/download/v1.8.9/luci-app-aliyundrive-webdav_1.8.9_all.ipk
wget https://github.com/messense/aliyundrive-webdav/releases/download/v1.8.9/luci-i18n-aliyundrive-webdav-zh-cn_1.8.9-1_all.ipk
opkg install aliyundrive-webdav_1.8.9-1_aarch64_generic.ipk
opkg install luci-app-aliyundrive-webdav_1.8.9_all.ipk
opkg install luci-i18n-aliyundrive-webdav-zh-cn_1.8.9-1_all.ipk
~~~

* x86 架构例子： 

~~~
wget https://github.com/messense/aliyundrive-webdav/releases/download/v1.8.9/aliyundrive-webdav_1.8.9-1_x86_64.ipk
wget https://github.com/messense/aliyundrive-webdav/releases/download/v1.8.9/luci-app-aliyundrive-webdav_1.8.9_all.ipk
wget https://github.com/messense/aliyundrive-webdav/releases/download/v1.8.9/luci-i18n-aliyundrive-webdav-zh-cn_1.8.9-1_all.ipk
opkg install aliyundrive-webdav_1.8.9-1_x86_64.ipk
opkg install luci-app-aliyundrive-webdav_1.8.9_all.ipk
opkg install luci-i18n-aliyundrive-webdav-zh-cn_1.8.9-1_all.ipk
~~~

1. 电脑chrome打开阿里云盘，F12调出console，登陆
    <https://www.aliyundrive.com>
1. chrome console \> Application \> Local Storage \> token \> access token
1. 进入openwrt \> 服务 \> 阿里云盘 WebDAV
    * 勾选 启用
    * Refresh Token: access token
        或者，双击输入框，会出现的二维码，用阿里云盘app扫描
    * 云盘根目录： /
    * 主机： openwrt 的 IP
    * 端口： 服务在openwrt上开的端口
    * 保存并应用
1. 浏览器登陆，如，http://openwrt-ip:aliyundrive-port 
1. 





## Alist

<https://alist-doc.nn.ci>
<https://github.com/alist-org/alist>
<https://github.com/alist-org/web-v2>

遇到的问题：

批量下载，如果alist在本地，很快；如果alist在局域网其他服务器，很慢，页面停留在“Downloading files, don't close or refresh the page”，另外还弹出一个新浏览器窗口，地址是"http://your-server-ip:5244/public/mitm.html"

### docker 使用

<https://hub.docker.com/r/xhofe/alist>

~~~sh
docker run -d --restart=always -v /etc/alist:/opt/alist/data -p 5244:5244 --name="alist" xhofe/alist:latest
~~~

启动后，查看启动日志（里面有初始密码）

~~~sh
docker logs alist
~~~

* 配置阿里云盘

    1. http://localhost:5244 访问管理页
    1. Acounts \> Add \> Type: AliDrive
    1. Refresh tocken: 
        1. 电脑chrome打开阿里云盘，F12调出console，登陆
            <https://www.aliyundrive.com>
        1. chrome console \> Application \> Local Storage \> token \> access token
    1. Virtual Path： 取个alist中显示的名字，比如，我的阿里云盘
    1. 返回主页，就能访问： http://localhost:5244/我的阿里云盘



### 手动安装

1. 下载
    ~~~
    wget https://github.com/alist-org/alist/releases/download/v2.6.3/alist-linux-amd64.tar.gz
    ~~~
    1. 解压运行
    ~~~
    # 解压下载对文件得到可执行文件：
    tar -zxvf alist-xxxx.tar.gz
    # 赋予程序执行权限：
    chmod +x alist-xxxx
    # 运行程序
    ./alist-xxxx
    ~~~
1. 守护进程
    ~~~sh
    [Unit]
    Description=alist
    After=network.target
     
    [Service]
    Type=simple
    WorkingDirectory=path_alist
    ExecStart=path_alist/alist-xxxx -conf data/config.json
    Restart=on-failure
     
    [Install]
    WantedBy=multi-user.target
    ~~~
1. 
1. 






















