---
layout: post
title: D-Link-Dir-686L 刷机
categories: [cm, router]
tags: [dd-wrt, openwrt, ac68u, merlin, 梅林]
---

* 参考
  * []()
  * []()
  * **koolshare**
  * [D-Link AC1750无线路由器DIR-868L开箱评测及试用报告](https://koolshare.cn/thread-480-1-1.html)
  * [DIR868L 2.4G WIFI异常修复图文教程 - 2021-3-12 ](https://koolshare.cn/thread-193388-1-1.html)
  * [Dlink Dir-868L刷ASUS固件384/386做AIMESH图文教程 - 2020-4-7](https://koolshare.cn/thread-179591-1-1.html)
  * [Koolshare_RMerl_New_Gen_384 - RT-AC68U 固件 - 刷CFE之后的868L可以用](http://firmware.koolshare.cn/Koolshare_RMerl_New_Gen_384/RT-AC68U/)
  * [Koolshare_RMerl_New_Gen_386 - RT-AC68U - 刷CFE之后的868L可以用](http://firmware.koolshare.cn/Koolshare_RMerl_New_Gen_386/RT-AC68U/)
  * []()
  * []()
  * **恩山论坛**
  * [恩山论坛 - Dlink dir868L刷Aimesh成功](https://www.right.com.cn/forum/thread-876407-1-1.html)
  * []()
  * [Flashing asus ac66 on dlink 868L for cheap wireless ai mesh router](https://www.reddit.com/r/HomeNetworking/comments/i1m046/flashing_asus_ac66_on_dlink_868l_for_cheap/)
  * [D-Link DIR-868L A1 刷DD-WRT 刷Tomato by Shibby 刷梅林固件](http://blog.su61.com/2019/04/02/d-link-dir-868l-a1-shuadd-wrt-shuatomato-by-shibby-shuameilingujian/)
  * [好室研研 - 洋垃圾DIR-868L复活记](https://www.housestudy.net/post/93.html)
  * [deviwiki.com - D-Link DIR-868L rev A1](https://deviwiki.com/wiki/D-Link_DIR-868L_rev_A1)
  * [DLINK - DIR-868L - REV_B - 官方固件下载](http://files.dlink.com.au/products/DIR-868L/REV_B/)
  * [DLINK - DIR-868L - REV_B - 网页](http://support.dlink.com.au/download/download.aspx?product=DIR-868L)
  * **西窗浪人**
  * [D-Link无线路由器DIR-868L梅林固件Spring 2021版本【已发布第2版，兼容两种软件中心】](https://www.bigxd.com/2021/03/913.html)
  * [D-Link无线路由器DIR-868L梅林固件V2.9版本，CFE2.2版本](https://www.bigxd.com/2020/10/802.html)
  * [D-Link无线路由器DIR-868L梅林固件V2.8版本，半年安全更新版](https://www.bigxd.com/2020/07/765.html)
  * [D-Link无线路由器DIR-868L梅林固件V2.7版本，3月紧急更新版](https://www.bigxd.com/2020/03/733.html)
  * [D-Link无线路由器DIR-868L梅林固件V2.5版本，修复AI-mesh功能，修复WAN指示灯初始状态](https://www.bigxd.com/2019/08/626.html)
  * [D-Link无线路由器DIR-868L梅林固件V2.3版本,CFE版本V1.6发布，更新到最新384.13分支](https://www.bigxd.com/2019/08/617.html)
  * [D-Link无线路由器DIR-868L原版CFE复刻版本下载，支持刷梅林](https://www.bigxd.com/2019/03/507.html)
  * []()
  * []()
  * []()
  * []()
  * []()


* DD-WRT 
  * [dd-wrt wiki - D-Link DIR-868L](https://wiki.dd-wrt.com/wiki/index.php/D-Link_DIR-868L)
  * [DD-Wrt固件下载地址 beta - DIR-868L - revb - r27147](ftp://ftp.dd-wrt.com/betas/2015/06-01-2015-r27147/dlink-dir868l-revb/)
  * []()




## mini CFE进入方法：

电脑设置手动IP:

IP地址为： 192.168.0.132
子网掩码： 255.255.255.0
网关： 192.168.0.1

设置好手动IP后拔掉路由器电源，用牙签捅住底部RESET孔不放，再插上电源，期间牙签也捅住不放，默数十秒后松开牙签，浏览器访问192.168.0.1即是mini CFE的web界面

* **恢复到原厂固件**

1. 页面显示： D-Link Router Recovery Mode
1. 点 Choose File 选择 `DIR868LB1_FW203B01.bin` 后，选择 upload 按钮
1. 固件更新完成，868L自动重启完成后，浏览器停在 `192.168.0.1/info/Login.html` ，显示 Admin Password 设置页面
1. 保险期间，恢复下出厂设置： Management -\> System Admin -\> Restore To Factory Default Settings


## 硬件规格

* D-Link DIR-868L A1
    Power: 12 VDC, 2.5 A
    CPU1: Broadcom BCM4708 (800 MHz, 2 cores)
    FLA1: 128 MiB (Spansion S34ML01G100TFI00)
    RAM1: 128 MiB (Micron MT47H64M16HR-25E:H)

    ETH chip1: Broadcom BCM4708
    Switch: Broadcom BCM4708
    LAN speed: 1G
    LAN ports: 4
    WAN speed: 1G
    WAN ports: 1


同类产品网件R6300V2比较一下： 

比较   | DIR-868L       | R6300 V2 |
SoC    | BCM4708 800Mhz | BCM4708 800Mhz |
Switch | in BCM4708     | in BCM4708 |
LAN    | 1000Mbps*4      | 1000 Mbps*4 |
Memory | 128MB           | 256MB |
Flash  | 128MB           | 128MB |
2.4G   | BCM4331         | BCM4331 |
5G     | BCM4360         | BCM4360 |
Extend | USB3.0*1        | USB3.0*1+USB2.0*1 |



## D-Link DIR-868L B1 FW:2.03


### 原厂固件 B1 2.03 刷到 梅林固件384

* 参考
    * [Dlink Dir-868L刷ASUS固件384/386做AIMESH图文教程 - 2020-4-7](https://koolshare.cn/thread-179591-1-1.html)
    

1. 刷机到dd-wrt
    1. 下载 dd-wrt 固件
        1. 访问 <ftp://ftp.dd-wrt.com/betas/2015/06-01-2015-r27147/dlink-dir868l-revb/>
            * r27147 是 rev.b 的第一个 dd-wrt 固件，后面的固件可能在 `mtd unlock /dev/mtd0` 失败，报错：
                ~~~
                mtd unlock /dev/mtd0
                Unlocking /dev/mtd0 ...
                Could not unlock MTD device: /dev/mtd0
                /dev/mtd0: Not supported
                ~~~
        1. 下载 `factory-to-ddwrt.bin`
    1. 进入 D-Link DIR-868L 管理界面，浏览器访问 192.168.0.1
    1. 进入 Admin Upgrade 固件升级页面，点击 `Select File` 选择刚下载的 `factory-to-ddwrt.bin`，确认开始刷机
    1. 等待几分钟，刷机成功后，路由器自动重启完成，浏览器访问 `192.168.1.1` 进入 DD-wrt 管理页面

1. 打开 dd-wrt 的 ssh 访问
    1. Services -\> Services Management -\> Secure Sehll
    1. SSHd： 勾选 Enable
    1. 点击 Apply Settings
    1. `ssh root@192.168.1.1` ，输入密码，就可登陆。 默认密码是root / admin，但是如果之前刷过dd-wrt，很可能是原来的管理员帐号和密码。原因可能是这个dd-wrt版本自己创建个分区，之前刷回原厂，并没有影响到这个分区。
        ~~~
        # cat /proc/mtd
        dev:   size        erasesize     name
        mtd0:  00200000    00010000      boot
        mtd1:  00010000    00010000      nvram_cfe
        mtd2:  00010000    00010000      nvram
        mtd3:  02000000    00020000      linux
        mtd4:  06000000    00020000      ddwrt
        ~~~

1. -----------

1. 备份CFE
    `dd` 备份cfe后，scp到电脑上
    ~~~
    root@DD-WRT:^# dd if=/dev/mtd/0 of=/tmp/boot.bin
    4096+0 records in
    4096+0 records out
    ~~~

1. -----------

1. 生成CFE文件
1. 用CFEEDIT打开下载到的`CFE_868L_melin384.bin`，修改MAC地址为你的地址：
    路由器的MAC地址正常就是你背面标签的那个MAC地址，换过外壳之类的就另说了。
    ~~~
    et0macaddr       --> 替换成路由器的mac地址
    0:macaddr        --> 替换成路由器的mac地址
    1:macaddr        --> 替换成路由器mac地址+4
    ~~~
    例如：
    ~~~
    et0macaddr=E4:6F:13:F6:F3:7C
    0:macaddr=E4:6F:13:F6:F3:7C
    1:macaddr=E4:6F:13:F6:F3:80
    ~~~
1. 修改完后的CFE另存为一个，这里以`CFE_868L_melin384_0000.bin`为例。
1. `CFE_868L_melin384_0000.bin` 上传到路由器的root目录下。
1. 
1. `ssh root@192.168.1.1` 登陆路由器，输入如下命令刷新CFE
    ~~~
    # mtd unlock /dev/mtd0
    Unlocking /dev/mtd0...
    # mtd write -f CFE_868L_melin384_0000.bin /dev/mtd0
    Writing from CFE_868L_melin384_0000.bin to /dev/mtd0...
    ~~~
1. CFE刷新后，输入reboot，同时马上按住reset，等到ttl=100，出现五次后，浏览器输入192.168.1.1（也可能是192.168.0.1）进入ASUS的CFE
  ![](asus-miniweb.png)
1. 进入华硕CFE后，先点击restore default NVRAM values。
    成功后，页面显示 : Command nvram erase completed. 点击Continue
1. 然后上传RT-AC68U_384.14_0_koolshare.trx（你也可以上传AC66U B1的原厂固件）
    上传要很久，不要动他！！！！等到上传完成后，会出现`Upload Completed. System is going to reboot.`。这个时候等着自动重启。有的人会碰到上传后出现浏览器跳转到找不到页面。
    找不到页面的，换个浏览器，重新进CFE再上传一次。
1. 等到TTL=64的时候，打开192.168.1.1.如果出现如下界面，显示`Welcome to RT-AC68U`
    ![](rt0ac66u_B1_刷机成功.png)
1. 
1. --- --- ---
1. 目前已知BUG如下：
    1、端口顺序翻转。LAN1变成WAN口，这个跟之前的EA6700/6500V2一样的。
    2、电源和INTERNET灯翻转。这个不确定是不是，反正两个灯都亮，但是电源灯是橙色的，INTERNET灯一直是绿色。
    3、系统中显示的RAM还是256M，但是868L应该是128M，这个不确定如果使用超出128会不会有问题，大家慎重！！
    4、原厂CFE备份出来用CFE编辑器打不开，这个可能是因为跟华硕的那个不一样。
    5、2021.01.02，有坛友反馈2.4G网速非常慢，由于楼主不用这个频，所以没发现，后续我测试完会反馈结果。（已经解决）
    https://koolshare.cn/thread-193388-1-1.html
1. 
1. 


### 已刷好 384 固件 更换 CFE

* 参考
  * [DIR868L 2.4G WIFI异常修复图文教程 - 2021-3-12 ](https://koolshare.cn/thread-193388-1-1.html)

1. 用到的文件是里面的：mtd-write、CFE_868L_2.4Gfix_5GPRO.bin这两个文件
    下载地址：
    链接：https://pan.baidu.com/s/1UEDVB612krWTvzgEU6dMug
    提取码：aw7b
1. 使用CFE Editor 修改 `CFE_868L_2.4Gfix_5GPRO.bin`
    需要修改MAC地址为自己路由器的真实MAC,MAC地址前六位用9C:5C:8E，否则MESH会搜不到节点。
    ~~~
    et0macaddr       --> 替换成路由器的mac地址
    0:macaddr        --> 替换成路由器的mac地址
    1:macaddr        --> 替换成路由器mac地址+4
    ~~~
1. 确认当前的系统版本，如果是386版本的，请降级到384版本。步骤可以参照最上面刷384的帖子。
1. 打开路由器的SSH：系统管理-系统设置-服务-启用SSH，选择LAN&WAN或者LAN only。
1. scp 上传mtd-write、CFE_868L_2.4Gfix_5GPRO.bin这两个文件到路由器
1. ssh连接到路由器上。然后先把原本的CFE做一下备份，并scp到电脑。命令如下：
    `dd if=/dev/mtd0 of=/tmp/home/root/cfe_bac.bin`
1. 刷入新的CFE，命令如下：
    ~~~
    chmod 755 mtd-write
    ./mtd-write -i CFE_868L_2.4Gfix.bin -d boot
    reboot
    ~~~
1. 重启后再进CFE清理一次nvram，恢复初始化设置。





## 其他可能用到的技巧

`cat /proc/mtd` 显示目前的分区

下载到 868L revB 对应的 mtd-write，可能可以使用
`chmod +x /tmp/mtd-write && /tmp/mtd-write -i /tmp/cfe_dir-868l_v1.3.bin -d boot && reboot`








